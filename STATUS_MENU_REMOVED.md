# üéØ –¢–ï–ö–£–©–ò–ô –°–¢–ê–¢–£–° –ë–û–¢–ê - –¢–û–õ–¨–ö–û LLM –ò–ù–¢–ï–†–§–ï–ô–°

## ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û

### –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ/—Å–æ–∑–¥–∞–Ω–Ω—ã–µ:

1. **`src/bot/handlers/start_handler.py`** ‚úÖ
   - –£–±—Ä–∞–Ω—ã: –∫–ª–∞—Å—Å—ã FSM, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –≤—Å–µ –º–µ–Ω—é—à–∫–∏
   - –î–æ–±–∞–≤–ª–µ–Ω–æ: –ø—Ä—è–º–æ–π –≤—ã–∑–æ–≤ INKA —Å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ–º
   - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏—Å—Ç–æ—Ä–∏—é —Ä–∞–∑–≥–æ–≤–æ—Ä–∞
   - –†–µ–∑—É–ª—å—Ç–∞—Ç: 40 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞ –≤–º–µ—Å—Ç–æ 200+

2. **`src/bot/handlers/client_handler.py`** ‚úÖ [–í–û–°–°–¢–ê–ù–û–í–õ–ï–ù]
   - –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω —Å –Ω—É–ª—è
   - –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π handler: @router.message(F.text)
   - –í—Å–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–¥—É—Ç –≤ INKA
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
   - –†–µ–∑—É–ª—å—Ç–∞—Ç: 68 —Å—Ç—Ä–æ–∫ –≤–º–µ—Å—Ç–æ 261

3. **`src/ai/advanced_inka.py`** ‚úÖ
   - System prompt –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω (130+ —Å—Ç—Ä–æ–∫ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π)
   - –î–æ–±–∞–≤–ª–µ–Ω—ã 4 —Ñ—É–Ω–∫—Ü–∏–∏ (database, calendar, web search, booking)
   - –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
   - –ö–ª–∏–µ–Ω—Ç-—Ü–µ–Ω—Ç—Ä–∏—á–Ω—ã–π –ø–æ–¥—Ö–æ–¥

## üöÄ –î–ï–ü–õ–û–ô –í–´–ü–û–õ–ù–ï–ù

```
–î–∞—Ç–∞: 2025-12-04 16:48:02 UTC
–†–µ–≤–∏–∑–∏—è: telegram-bot-00029-42v
–†–µ–≥–∏–æ–Ω: us-central1 (Google Cloud Run)
–°—Ç–∞—Ç—É—Å: –ê–ö–¢–ò–í–ï–ù ‚úÖ
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤:
```
‚úÖ 16:48:02 - –ë–æ—Ç –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ
‚úÖ 16:48:01 - Webhook —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
‚úÖ 16:47:58 - Server listening on 0.0.0.0:8080
‚úÖ 16:41:38 - Update 253957030 –æ–±—Ä–∞–±–æ—Ç–∞–Ω –∑–∞ 45.6 —Å–µ–∫ (INKA —Ä–∞–±–æ—Ç–∞–µ—Ç)
```

## üìã –¢–ï–ö–£–©–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê

### –í—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:
```
Telegram User ‚Üí Bot API ‚Üí Cloud Run
                             ‚Üì
                        [start_handler.py] (—Ç–æ–ª—å–∫–æ /start)
                             ‚Üì
                        –∏–ª–∏
                             ‚Üì
                        [client_handler.py] (–≤—Å–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è)
                             ‚Üì
                        [INKA - Advanced]
                             ‚Üì
                    (–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –¥–µ–π—Å—Ç–≤–∏–µ)
                             ‚Üì
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚Üì         ‚Üì         ‚Üì
            simple_chat  get_database  get_calendar
                       
            –ì–æ—Ç–æ–≤–∏—Ç –æ—Ç–≤–µ—Ç (JSON —á–µ—Ä–µ–∑ OpenAI Assistant)
                             ‚Üì
                        Cloud Run Bot API
                             ‚Üì
                        Telegram User
```

## üí¨ –ü–†–ò–ú–ï–†–´ –†–ê–ë–û–¢–´

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –•–æ–ª–æ–¥–Ω—ã–π –∫–ª–∏–µ–Ω—Ç
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ø—Ä–∏–≤–µ—Ç
INKA: –ü—Ä–∏–≤–µ—Ç! üòä –ö–∞–∫ –¥–µ–ª–∞? –î—É–º–∞–µ—à—å –Ω–∞–¥ —Ç–∞—Ç—É–∏—Ä–æ–≤–∫–æ–π?

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –º–æ–∂–µ—Ç –±—ã—Ç—å, –∫–∞–∫–∏–µ —É –≤–∞—Å —Ü–µ–Ω—ã?
INKA: [–≤—ã–∑—ã–≤–∞–µ—Ç get_database_info –¥–ª—è price_list]
      –ú–∞–ª–µ–Ω—å–∫–∞—è —Ç–∞—Ç—É–∏—Ä–æ–≤–∫–∞ –æ—Ç 3000‚ÇΩ, —Å—Ä–µ–¥–Ω—è—è –æ—Ç 7000‚ÇΩ.
      –ó–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç–∏. –ö–∞–∫—É—é –∏–¥–µ—é –¥—É–º–∞–µ—à—å?
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ì–æ—Ä—è—á–∏–π –∫–ª–∏–µ–Ω—Ç
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –∑–∞–ø–∏—Å–∞—Ç—å –º–µ–Ω—è –Ω–∞ —Ç–∞—Ç—É–∏—Ä–æ–≤–∫—É
INKA: –û, –∫–ª–∞—Å—Å–Ω–æ! –£–∂–µ –∑–Ω–∞–µ—à—å —á—Ç–æ —Ö–æ—á–µ—à—å?

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –º–∞–ª–µ–Ω—å–∫–∞—è –Ω–∞–¥–ø–∏—Å—å –Ω–∞ —Ä—É–∫–µ
INKA: [–≤—ã–∑—ã–≤–∞–µ—Ç get_calendar_slots –¥–ª—è –±–ª–∏–∂–∞–π—à–∏—Ö 7 –¥–Ω–µ–π]
      –ï—Å—Ç—å —Å–ª–æ—Ç—ã:
      ‚Ä¢ –∑–∞–≤—Ç—Ä–∞ –≤ 14:00
      ‚Ä¢ –≤ –ø—è—Ç–Ω–∏—Ü—É –≤ 11:00
      –ö–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥–∏—Ç?

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –∑–∞–≤—Ç—Ä–∞ –≤ 14:00
INKA: [–≤—ã–∑—ã–≤–∞–µ—Ç create_booking]
      –°—É–ø–µ—Ä! –¢—ã –∑–∞–ø–∏—Å–∞–Ω –Ω–∞ –∑–∞–≤—Ç—Ä–∞ –≤ 14:00 –∫ –º–∞—Å—Ç–µ—Ä—É –ê–Ω–µ.
      –ü—Ä–∏—Ö–æ–¥–∏ –∑–∞ 5 –º–∏–Ω –¥–æ —Å–µ–∞–Ω—Å–∞. –ñ–¥—ë–º —Ç–µ–±—è! üí™
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –°–ª–æ–∂–Ω—ã–π –∫–ª–∏–µ–Ω—Ç (–Ω—É–∂–Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è)
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: —Ö–æ—á—É –±–æ–ª—å—à—É—é —Ä–∞–±–æ—Ç—É —Å–æ —Å–ª–æ–∂–Ω—ã–º —ç—Å–∫–∏–∑–æ–º
INKA: –û, —Å–µ—Ä—å–µ–∑–Ω–æ! –≠—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ.
      –¢–∞–∫–∏–µ —Ä–∞–±–æ—Ç—ã –ª—É—á—à–µ –æ–±—Å—É–¥–∏—Ç—å –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏.
      –ö–æ–≥–¥–∞ —Ç—ã —Å–≤–æ–±–æ–¥–µ–Ω? –ö–æ–Ω—Å–∞ —É –Ω–∞—Å –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è.
```

## ‚öôÔ∏è INKA –§–£–ù–ö–¶–ò–ò

| –§—É–Ω–∫—Ü–∏—è | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å | –ü—Ä–∏–º–µ—Ä |
|---------|-------------------|--------|
| **get_database_info** | –ö–æ–≥–¥–∞ —Å–ø—Ä–∞—à–∏–≤–∞—é—Ç –ø—Ä–æ –¥–∞–Ω–Ω—ã–µ | "–°–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç?", "–£ –≤–∞—Å –µ—Å—Ç—å –º–∞—Å—Ç–µ—Ä –ê–Ω—è?" |
| **get_calendar_slots** | –ö–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç –≥–æ—Ç–æ–≤ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è | "–ö–æ–≥–¥–∞ –º–æ–∂–Ω–æ?", "–ó–∞–ø–∏—à–∏ –º–µ–Ω—è –Ω–∞..." |
| **search_web** | –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —Å–Ω–∞—Ä—É–∂–∏ | "–ö–∞–∫ —É—Ö–∞–∂–∏–≤–∞—Ç—å?", "–ö–∞–∫ –¥–æ–ª–≥–æ –∑–∞–∂–∏–≤–∞–µ—Ç?" |
| **create_booking** | –ö–æ–≥–¥–∞ –≤—Å–µ –¥–µ—Ç–∞–ª–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω—ã | –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –¥–∞—Ç—ã/–≤—Ä–µ–º–µ–Ω–∏/–º–∞—Å—Ç–µ—Ä–∞ |

## üîç –ú–û–ù–ò–¢–û–†–ò–ù–ì

–°–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏:
```bash
gcloud logging read "resource.type=cloud_run_revision AND resource.labels.service_name=telegram-bot" \
  --limit=30 --project=tattoo-480007 --format="table(timestamp,severity,textPayload)"
```

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å:
```bash
gcloud run services describe telegram-bot --region us-central1 --project tattoo-480007
```

## ‚ú® –ß–¢–û –†–ê–ë–û–¢–ê–ï–¢

- ‚úÖ Webhook —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å Telegram
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ INKA —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏ OpenAI Assistant
- ‚úÖ –î–æ—Å—Ç—É–ø –∫ Google Sheets
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —ç–º–æ–¥–∑–∏
- ‚úÖ –§–æ–Ω–æ–≤—ã–π typing indicator

## ‚ö†Ô∏è –ß–¢–û –ù–ï –†–ê–ë–û–¢–ê–ï–¢ / –û–¢–ö–õ–Æ–ß–ï–ù–û

- ‚ùå –ú–µ–Ω—é —Å –∫–Ω–æ–ø–∫–∞–º–∏ (—É–±—Ä–∞–Ω—ã)
- ‚ùå FSM states –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (—É–ø—Ä–æ—â–µ–Ω–æ)
- ‚ùå Callback handlers (—É–±—Ä–∞–Ω—ã)
- ‚ùå Inline keyboards (—É–±—Ä–∞–Ω—ã)
- ‚ùå Reply keyboards (—É–±—Ä–∞–Ω—ã)

## üìä–¢–ï–ö –¢–Æ –©–ò–ï –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò

**Config (–∏–∑ Secret Manager):**
```
TELEGRAM_BOT_TOKEN: ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
OPENAI_API_KEY: ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (–æ—á–∏—â–µ–Ω –æ—Ç —Å–ø–µ—Ü. —Å–∏–º–≤–æ–ª–æ–≤)
GOOGLE_SPREADSHEET_ID: ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (–æ—á–∏—â–µ–Ω –æ—Ç —Å–ª–µ—à–∞)
GOOGLE_CREDENTIALS_JSON: ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
```

**OpenAI Assistant:**
```
ID: asst_LBGeLxauJ3nYbauR3pilbifN
Model: gpt-4o
Functions: 4 (database, calendar, web, booking)
```

**Google Sheets:**
```
ID: 17mB1AFzy2lr2x3j9uSWEOOG4lzAStMChkHwPQFLzjoQ
Tables: 7 (masters, clients, bookings, services, schedule, reviews, price_list)
```

## üéØ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò (–µ—Å–ª–∏ –Ω—É–∂–Ω—ã)

1. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Telegram**
   - –ù–∞–π—Ç–∏ @inkamanager_bot
   - –û—Ç–ø—Ä–∞–≤–∏—Ç—å /start
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å —Ä–∞–∑–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ —Å–æ–æ–±—â–µ–Ω–∏–π

2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**
   - –°–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –≤ Cloud Run
   - –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ INKA –≤—ã–∑—ã–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–æ–≤

3. **–î–æ—Ä–∞–±–æ—Ç–∫–∏** (–µ—Å–ª–∏ –Ω—É–∂–Ω—ã)
   - –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ —Ñ—É–Ω–∫—Ü–∏–π
   - –£–ª—É—á—à–∏—Ç—å –ø—Ä–æ–º–ø—Ç INKA
   - –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –≤–µ–±-–ø–æ–∏—Å–∫ (Bing API, Google Search API)

## üéâ –í–°–ï –ì–û–¢–û–í–û!

–ë–æ—Ç —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç, –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å INKA LLM –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º.
–ù–∏–∫–∞–∫–∏—Ö –º–µ–Ω—é - —Ç–æ–ª—å–∫–æ –∂–∏–≤–æ–µ –æ–±—â–µ–Ω–∏–µ —Å AI –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º!

–õ—é–±—ã–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è INKA, –∫–æ—Ç–æ—Ä–∞—è:
- –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø –∫–ª–∏–µ–Ω—Ç–∞
- –í—ã–±–∏—Ä–∞–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –æ–±—â–µ–Ω–∏—è
- –í—ã–∑—ã–≤–∞–µ—Ç –Ω—É–∂–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- –î–∞–µ—Ç –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç

**–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞:** ~2-10 —Å–µ–∫ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–∞
**–°—Ç–∞—Ç—É—Å:** –û–Ω–ª–∞–π–Ω 24/7 –Ω–∞ Google Cloud Run ‚úÖ
