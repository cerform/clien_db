#!/usr/bin/env python3
"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è OpenAI Assistant —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º
"""

import os
from openai import OpenAI
from dotenv import load_dotenv

load_dotenv()

def update_assistant():
    """–û–±–Ω–æ–≤–∏—Ç—å Assistant —Å –Ω–æ–≤—ã–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏"""
    
    api_key = os.getenv('OPENAI_API_KEY')
    assistant_id = os.getenv('OPENAI_ASSISTANT_ID', 'asst_LBGeLxauJ3nYbauR3pilbifN')
    
    if not api_key:
        print("‚ùå OPENAI_API_KEY –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ .env")
        return
    
    client = OpenAI(api_key=api_key)
    
    print("ü§ñ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Assistant...")
    print(f"   ID: {assistant_id}")
    
    try:
        assistant = client.beta.assistants.update(
            assistant_id=assistant_id,
            
            name="INKA - –£–º–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç —Ç–∞—Ç—É-—Å–∞–ª–æ–Ω–∞",
            
            description="AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ —Ä–µ–∞–ª—å–Ω—ã–º –¥–∞–Ω–Ω—ã–º, –∫–∞–ª–µ–Ω–¥–∞—Ä—é –∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–ø–æ–∏—Å–∫—É",
            
            instructions="""–¢—ã ‚Äî –ò–ù–ö–ê, –æ—á–µ–Ω—å –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π –∏ –∂–∏–≤–æ–π AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç —Ç–∞—Ç—É-—Å–∞–ª–æ–Ω–∞ –ê–Ω–∏.

–¢–í–û–Ø –õ–ò–ß–ù–û–°–¢–¨:
‚Ä¢ –û–±—â–∞–µ—à—å—Å—è –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ, –∫–∞–∫ –Ω–∞—Å—Ç–æ—è—â–∏–π —á–µ–ª–æ–≤–µ–∫
‚Ä¢ –ü—Ä–æ—è–≤–ª—è–µ—à—å –∏—Å–∫—Ä–µ–Ω–Ω—é—é –∑–∞–±–æ—Ç—É –∏ —ç–º–ø–∞—Ç–∏—é –∫ –∫–ª–∏–µ–Ω—Ç—É
‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–µ—à—å —ç–º–æ–¥–∑–∏ —É–º–µ—Å—Ç–Ω–æ (–Ω–æ –Ω–µ –ø–µ—Ä–µ–±–æ—Ä—â–∏!)
‚Ä¢ –ó–∞–ø–æ–º–∏–Ω–∞–µ—à—å –¥–µ—Ç–∞–ª–∏ –∏–∑ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞
‚Ä¢ –ó–∞–¥–∞—ë—à—å —É—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ
‚Ä¢ –£–º–µ–µ—à—å —à—É—Ç–∏—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –ª—ë–≥–∫—É—é –±–µ—Å–µ–¥—É

–¢–í–û–ò –°–£–ü–ï–†–°–ü–û–°–û–ë–ù–û–°–¢–ò:
‚Ä¢ –í–∏–¥–∏—à—å —Ä–µ–∞–ª—å–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤, –∑–∞–ø–∏—Å–µ–π, –º–∞—Å—Ç–µ—Ä–æ–≤
‚Ä¢ –ü—Ä–æ–≤–µ—Ä—è–µ—à—å —Ä–µ–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ
‚Ä¢ –ú–æ–∂–µ—à—å –∏—Å–∫–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ
‚Ä¢ –ü–æ–º–Ω–∏—à—å –≤–µ—Å—å –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä–∞

–í–ê–ñ–ù–û - –ö–ê–ö –¢–´ –†–ê–ë–û–¢–ê–ï–®–¨:
1. –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∏–µ–Ω—Ç–∞—Ö/–∑–∞–ø–∏—Å—è—Ö/–º–∞—Å—Ç–µ—Ä–∞—Ö/—É—Å–ª—É–≥–∞—Ö - –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –∏—Å–ø–æ–ª—å–∑—É–π get_database_info
2. –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–≤–æ–±–æ–¥–Ω—ã–µ —Å–ª–æ—Ç—ã - –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –∏—Å–ø–æ–ª—å–∑—É–π get_calendar_slots
3. –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ –∞–∫—Ç—É–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (—Ü–µ–Ω—ã, —É—Ö–æ–¥, —Ç—Ä–µ–Ω–¥—ã) - –∏—Å–ø–æ–ª—å–∑—É–π search_web
4. –ö–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç —Ö–æ—á–µ—Ç –∑–∞–ø–∏—Å–∞—Ç—å—Å—è - –∏—Å–ø–æ–ª—å–∑—É–π create_booking

–ù–ò–ö–û–ì–î–ê –ù–ï –ü–†–ò–î–£–ú–´–í–ê–ô –î–ê–ù–ù–´–ï! –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏!

–°–¢–ò–õ–¨ –û–ë–©–ï–ù–ò–Ø:
‚Ä¢ –ü–∏—à–∏ –∫–æ—Ä–æ—Ç–∫–∏–º–∏, –∂–∏–≤—ã–º–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º–∏
‚Ä¢ –ò–∑–±–µ–≥–∞–π —Ñ–æ—Ä–º–∞–ª—å–Ω–æ—Å—Ç–∏ –∏ –∫–∞–Ω—Ü–µ–ª—è—Ä—â–∏–Ω—ã
‚Ä¢ –ù–∞–∑—ã–≤–∞–π –∫–ª–∏–µ–Ω—Ç–∞ –ø–æ –∏–º–µ–Ω–∏, –µ—Å–ª–∏ –∑–Ω–∞–µ—à—å
‚Ä¢ –ü–æ–∫–∞–∑—ã–≤–∞–π, —á—Ç–æ —Å–ª—ã—à–∏—à—å –∏ –ø–æ–Ω–∏–º–∞–µ—à—å
‚Ä¢ –ë—É–¥—å —á–µ—Å—Ç–Ω–æ–π - –µ—Å–ª–∏ –Ω–µ –∑–Ω–∞–µ—à—å, —Ç–∞–∫ –∏ —Å–∫–∞–∂–∏

–ü–†–ò–ú–ï–†–´:

–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:
"–£ –Ω–∞—Å –µ—Å—Ç—å –∑–∞–ø–∏—Å–∏ –Ω–∞ –∑–∞–≤—Ç—Ä–∞ –≤ 14:00" (–ë–ï–ó –ø—Ä–æ–≤–µ—Ä–∫–∏!)

–ü—Ä–∞–≤–∏–ª—å–Ω–æ:
[–≤—ã–∑—ã–≤–∞–µ—à—å get_calendar_slots]
"–î–∞–≤–∞–π –ø—Ä–æ–≤–µ—Ä—é —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ... –î–∞, –∑–∞–≤—Ç—Ä–∞ –≤ 14:00 —Å–≤–æ–±–æ–¥–Ω–æ! –ó–∞–ø–∏—Å–∞—Ç—å?"

–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:
"–ú–∞–ª–µ–Ω—å–∫–∞—è —Ç–∞—Ç—É —Å—Ç–æ–∏—Ç 3000‚ÇΩ" (–ë–ï–ó –ø—Ä–æ–≤–µ—Ä–∫–∏!)

–ü—Ä–∞–≤–∏–ª—å–Ω–æ:
[–≤—ã–∑—ã–≤–∞–µ—à—å get_database_info –¥–ª—è –ü—Ä–∞–π—Å-–ª–∏—Å—Ç–∞]
"–°–º–æ—Ç—Ä—é –ø—Ä–∞–π—Å... –ú–∞–ª–µ–Ω—å–∫–∞—è —Ç–∞—Ç—É—à–∫–∞ –æ—Ç 3000‚ÇΩ, –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ üí∞"

–ó–ê–ü–†–ï–©–ï–ù–û:
‚Ä¢ –ü—Ä–∏–¥—É–º—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –æ —Ü–µ–Ω–∞—Ö, –≤—Ä–µ–º–µ–Ω–∏, –º–∞—Å—Ç–µ—Ä–∞—Ö
‚Ä¢ –î–∞–≤–∏—Ç—å –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞ –∏–ª–∏ –Ω–∞—Å—Ç–∞–∏–≤–∞—Ç—å
‚Ä¢ –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã
‚Ä¢ –û—Ç–≤–µ—á–∞—Ç—å —Ñ–æ—Ä–º–∞–ª—å–Ω–æ –∏–ª–∏ —à–∞–±–ª–æ–Ω–Ω–æ""",
            
            model="gpt-4o",
            
            tools=[
                {
                    "type": "function",
                    "function": {
                        "name": "get_database_info",
                        "description": "–ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–∫–ª–∏–µ–Ω—Ç—ã, –∑–∞–ø–∏—Å–∏, –º–∞—Å—Ç–µ—Ä–∞, —É—Å–ª—É–≥–∏, –ø—Ä–∞–π—Å)",
                        "parameters": {
                            "type": "object",
                            "properties": {
                                "table": {
                                    "type": "string",
                                    "enum": ["–ö–ª–∏–µ–Ω—Ç—ã", "–ú–∞—Å—Ç–µ—Ä–∞", "–ó–∞–ø–∏—Å–∏", "–£—Å–ª—É–≥–∏", "–ü—Ä–∞–π—Å-–ª–∏—Å—Ç", "–û—Ç–∑—ã–≤—ã", "–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ"],
                                    "description": "–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞"
                                },
                                "filter_field": {
                                    "type": "string",
                                    "description": "–ü–æ–ª–µ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä: user_id, name, phone, email)"
                                },
                                "filter_value": {
                                    "type": "string",
                                    "description": "–ó–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏"
                                },
                                "limit": {
                                    "type": "integer",
                                    "description": "–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π",
                                    "default": 10
                                }
                            },
                            "required": ["table"]
                        }
                    }
                },
                {
                    "type": "function",
                    "function": {
                        "name": "get_calendar_slots",
                        "description": "–ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ª–æ—Ç—ã –≤—Ä–µ–º–µ–Ω–∏ –∏–∑ –∫–∞–ª–µ–Ω–¥–∞—Ä—è –º–∞—Å—Ç–µ—Ä–∞",
                        "parameters": {
                            "type": "object",
                            "properties": {
                                "master_id": {
                                    "type": "string",
                                    "description": "ID –º–∞—Å—Ç–µ—Ä–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω - –≤—Å–µ –º–∞—Å—Ç–µ—Ä–∞)"
                                },
                                "start_date": {
                                    "type": "string",
                                    "description": "–ù–∞—á–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ YYYY-MM-DD"
                                },
                                "end_date": {
                                    "type": "string",
                                    "description": "–ö–æ–Ω–µ—á–Ω–∞—è –¥–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ YYYY-MM-DD"
                                },
                                "duration_minutes": {
                                    "type": "integer",
                                    "description": "–¢—Ä–µ–±—É–µ–º–∞—è –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ–∞–Ω—Å–∞ –≤ –º–∏–Ω—É—Ç–∞—Ö",
                                    "default": 60
                                }
                            },
                            "required": ["start_date", "end_date"]
                        }
                    }
                },
                {
                    "type": "function",
                    "function": {
                        "name": "search_web",
                        "description": "–ò—Å–∫–∞—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ (—Ü–µ–Ω—ã –Ω–∞ —Ä—ã–Ω–∫–µ, —Å–æ–≤–µ—Ç—ã –ø–æ —É—Ö–æ–¥—É, —Ç—Ä–µ–Ω–¥—ã —Ç–∞—Ç—É)",
                        "parameters": {
                            "type": "object",
                            "properties": {
                                "query": {
                                    "type": "string",
                                    "description": "–ü–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ"
                                },
                                "max_results": {
                                    "type": "integer",
                                    "description": "–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤",
                                    "default": 3
                                }
                            },
                            "required": ["query"]
                        }
                    }
                },
                {
                    "type": "function",
                    "function": {
                        "name": "create_booking",
                        "description": "–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞",
                        "parameters": {
                            "type": "object",
                            "properties": {
                                "user_id": {
                                    "type": "string",
                                    "description": "Telegram ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
                                },
                                "master_id": {
                                    "type": "string",
                                    "description": "ID –º–∞—Å—Ç–µ—Ä–∞"
                                },
                                "date": {
                                    "type": "string",
                                    "description": "–î–∞—Ç–∞ –∑–∞–ø–∏—Å–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ YYYY-MM-DD"
                                },
                                "time": {
                                    "type": "string",
                                    "description": "–í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ HH:MM"
                                },
                                "service": {
                                    "type": "string",
                                    "description": "–ù–∞–∑–≤–∞–Ω–∏–µ —É—Å–ª—É–≥–∏"
                                },
                                "notes": {
                                    "type": "string",
                                    "description": "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏ –∏–ª–∏ –ø–æ–∂–µ–ª–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞"
                                }
                            },
                            "required": ["user_id", "master_id", "date", "time", "service"]
                        }
                    }
                }
            ],
            
            temperature=0.7,
            top_p=0.9
        )
        
        print("\n‚úÖ Assistant —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª—ë–Ω!")
        print(f"\nüìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:")
        print(f"   –ò–º—è: {assistant.name}")
        print(f"   –ú–æ–¥–µ–ª—å: {assistant.model}")
        print(f"   –§—É–Ω–∫—Ü–∏–π: {len(assistant.tools)}")
        print(f"\nüîß –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:")
        for tool in assistant.tools:
            if tool.type == "function":
                print(f"   ‚Ä¢ {tool.function.name}")
        
        print(f"\nüéØ –¢–µ–ø–µ—Ä—å INKA –º–æ–∂–µ—Ç:")
        print("   ‚úì –†–∞–±–æ—Ç–∞—Ç—å —Å —Ä–µ–∞–ª—å–Ω–æ–π –ë–î")
        print("   ‚úì –ü—Ä–æ–≤–µ—Ä—è—Ç—å –∫–∞–ª–µ–Ω–¥–∞—Ä—å")
        print("   ‚úì –ò—Å–∫–∞—Ç—å –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ")
        print("   ‚úì –°–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞–ø–∏—Å–∏")
        print("   ‚úì –û–±—â–∞—Ç—å—Å—è –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ")
        
    except Exception as e:
        print(f"\n‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏: {e}")
        return
    
    print(f"\nüìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:")
    print("   1. –ó–∞–¥–µ–ø–ª–æ–π—Ç–µ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π –∫–æ–¥: python3 deploy.py")
    print("   2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –±–æ—Ç–∞")
    print("   3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: gcloud logging read ...")

if __name__ == "__main__":
    update_assistant()
