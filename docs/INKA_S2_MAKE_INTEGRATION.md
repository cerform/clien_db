# INKA S2 ‚Äî –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Make.com

## –û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ S1: Classification & Consultation                         ‚îÇ
‚îÇ (Python Bot + INKA AI)                                    ‚îÇ
‚îÇ                                                           ‚îÇ
‚îÇ ‚Ä¢ –ö–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –Ω–∞–º–µ—Ä–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞                        ‚îÇ
‚îÇ ‚Ä¢ –û—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã (consultation, info)               ‚îÇ
‚îÇ ‚Ä¢ –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—é                    ‚îÇ
‚îÇ ‚Ä¢ route="booking" ‚Üí next_action="offer_slots"            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                  ‚îÇ
                  ‚îÇ webhook/API call
                  ‚îÇ payload: {route, stage, booking_type, client_id}
                  ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ S2: Booking Engine                                        ‚îÇ
‚îÇ (Make.com Scenario)                              ‚óÑ‚îÄ‚îÄ –¢–£–¢ ‚îÇ
‚îÇ                                                           ‚îÇ
‚îÇ –®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ª–æ—Ç—ã –∏–∑ –ë–î                    ‚îÇ
‚îÇ –®–∞–≥ 2: –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ booking_type                     ‚îÇ
‚îÇ –®–∞–≥ 3: –í—ã–∑–≤–∞—Ç—å OpenAI —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º –ø—Ä–æ–º–ø—Ç–æ–º S2            ‚îÇ
‚îÇ –®–∞–≥ 4: –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ + inline keyboard             ‚îÇ
‚îÇ                                                           ‚îÇ
‚îÇ –ü—Ä–∏ –≤—ã–±–æ—Ä–µ —Å–ª–æ—Ç–∞:                                         ‚îÇ
‚îÇ –®–∞–≥ 5: –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å slot_id                              ‚îÇ
‚îÇ –®–∞–≥ 6: –í—ã–∑–≤–∞—Ç—å OpenAI (confirming_choice)                ‚îÇ
‚îÇ –®–∞–≥ 7: –ü–µ—Ä–µ–¥–∞—Ç—å –≤ S3                                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                  ‚îÇ
                  ‚îÇ slot_id –≤—ã–±—Ä–∞–Ω
                  ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ S3: Confirmation & Payment                                ‚îÇ
‚îÇ (Make.com Scenario)                                       ‚îÇ
‚îÇ                                                           ‚îÇ
‚îÇ ‚Ä¢ –ë—Ä–æ–Ω–∏—Ä—É–µ—Ç —Å–ª–æ—Ç –≤ Google Sheets                          ‚îÇ
‚îÇ ‚Ä¢ –°–æ–∑–¥–∞—ë—Ç —Å–æ–±—ã—Ç–∏–µ –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ                             ‚îÇ
‚îÇ ‚Ä¢ –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Make.com Scenario S2

### üìç –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π

1. –ó–∞–π–¥–∏ –≤ Make.com
2. –°–æ–∑–¥–∞–π –Ω–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π: **"INKA S2 - Booking Engine"**
3. –£—Å—Ç–∞–Ω–æ–≤–∏ —Ç—Ä–∏–≥–≥–µ—Ä: **Webhook** (–¥–ª—è –ø—Ä–∏—ë–º–∞ –¥–∞–Ω–Ω—ã—Ö –æ—Ç Python –±–æ—Ç–∞)

### üìç –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Webhook

**–ú–æ–¥—É–ª—å**: Webhooks ‚Üí Custom Webhook

**–û–∂–∏–¥–∞–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö:**
```json
{
  "client_id": "123456789",
  "client_name": "–ò–≤–∞–Ω",
  "route": "booking",
  "stage": "offer_slots",
  "booking_type": "tattoo",
  "message": "—Ö–æ—á—É –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —Ç–∞—Ç—É"
}
```

**Webhook URL:** –°–∫–æ–ø–∏—Ä—É–π –∏ —Å–æ—Ö—Ä–∞–Ω–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ Python –±–æ—Ç–µ.

---

### üìç –®–∞–≥ 3: –ü–æ–ª—É—á–∏—Ç—å —Å–ª–æ—Ç—ã –∏–∑ Google Sheets

**–ú–æ–¥—É–ª—å**: Google Sheets ‚Üí Search Rows

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏:**
- **Spreadsheet**: –í—ã–±–µ—Ä–∏ —Å–≤–æ–π spreadsheet
- **Sheet**: `Slots`
- **Search Filter**: 
  ```
  available = YES
  booking_type = {{1.booking_type}}
  ```
- **Limit**: 10 (–æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–æ—Ç–æ–≤)

**Output**: –ú–∞—Å—Å–∏–≤ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤

---

### üìç –®–∞–≥ 4: –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–ª–æ—Ç—ã –≤ –º–∞—Å—Å–∏–≤

**–ú–æ–¥—É–ª—å**: Tools ‚Üí Text Aggregator

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏:**
- **Source Module**: Google Sheets (Search Rows)
- **Text**: 
  ```json
  {
    "slot_id": "{{4.slot_id}}",
    "date": "{{4.date}}",
    "start_time": "{{4.start_time}}",
    "end_time": "{{4.end_time}}"
  }
  ```
- **Row separator**: `,`
- **Group by**: (–æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º)

**Output**: JSON –º–∞—Å—Å–∏–≤ —Å–ª–æ—Ç–æ–≤ –¥–ª—è OpenAI

---

### üìç –®–∞–≥ 5: –í—ã–∑–≤–∞—Ç—å OpenAI –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è

**–ú–æ–¥—É–ª—å**: OpenAI ‚Üí Create Chat Completion

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∏:

**Model**: `gpt-3.5-turbo` (–∏–ª–∏ `gpt-4`)

**Messages**:

1. **System Message** (Role: `system`):
   
   **–ö–æ–ø–∏—Ä—É–π –≤–µ—Å—å —Ç–µ–∫—Å—Ç –∏–∑ —Ñ–∞–π–ª–∞ `docs/INKA_S2_BOOKING_ENGINE_PROMPT.md`** (–±–ª–æ–∫ –º–µ–∂–¥—É ``` ```)

   –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π –∫–æ—Ä–æ—Ç–∫—É—é –≤–µ—Ä—Å–∏—é:
   ```
   –¢—ã ‚Äî –ò–ù–ö–ê, –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç —Ç–∞—Ç—É-–º–∞—Å—Ç–µ—Ä–∞ –ê–Ω–∏.
   –¢—ã —Ä–∞–±–æ—Ç–∞–µ—à—å –≤ —Å—Ü–µ–Ω–∞—Ä–∏–∏ S2 (Booking Engine).
   
   –ó–∞–¥–∞—á–∞: –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∫–ª–∏–µ–Ω—Ç—É –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ª–æ—Ç—ã –∏–∑ –º–∞—Å—Å–∏–≤–∞ available_slots.
   
   –ú–∞—Å—Å–∏–≤ —Å–ª–æ—Ç–æ–≤: {{5.text}}
   
   –ü—Ä–∞–≤–∏–ª–∞:
   - –ò—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û —Å–ª–æ—Ç—ã –∏–∑ –º–∞—Å—Å–∏–≤–∞
   - –ù–µ –ø—Ä–∏–¥—É–º—ã–≤–∞–π –¥–∞—Ç—ã
   - –ö–æ—Ä–æ—Ç–∫–∏–π, —á–µ–ª–æ–≤–µ—á–Ω—ã–π –æ—Ç–≤–µ—Ç (2-4 —Å—Ç—Ä–æ–∫–∏)
   - –ü–µ—Ä–µ—á–∏—Å–ª–∏ –≤—Å–µ —Å–ª–æ—Ç—ã
   - –î–æ–±–∞–≤—å: "–ù–∞–∂–º–∏ –Ω–∞ —É–¥–æ–±–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç, –∏ —è –∑–∞–∫—Ä–µ–ø–ª—é –≤—Ä–µ–º—è."
   
   –ï—Å–ª–∏ –º–∞—Å—Å–∏–≤ –ø—É—Å—Ç–æ–π:
   "–°–µ–π—á–∞—Å —Å–≤–æ–±–æ–¥–Ω—ã—Ö –æ–∫–æ–Ω –¥–ª—è —ç—Ç–æ–≥–æ —Ç–∏–ø–∞ –∑–∞–ø–∏—Å–∏ –Ω–µ—Ç.
   –ú–æ–≥—É –Ω–∞–ø–∏—Å–∞—Ç—å —Ç–µ–±–µ, –∫–∞–∫ —Ç–æ–ª—å–∫–æ –ø–æ—è–≤–∏—Ç—Å—è –ø–æ–¥—Ö–æ–¥—è—â–µ–µ –≤—Ä–µ–º—è."
   ```

2. **User Message** (Role: `user`):
   ```
   –ö–ª–∏–µ–Ω—Ç —Ö–æ—á–µ—Ç –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ {{1.booking_type}}.
   –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ª–æ—Ç—ã: {{5.text}}
   ```

**Temperature**: `0.7`

**Max Tokens**: `200`

**Output**: –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞

---

### üìç –®–∞–≥ 6: –°–æ–∑–¥–∞—Ç—å Inline Keyboard –¥–ª—è Telegram

**–ú–æ–¥—É–ª—å**: Tools ‚Üí Set Variable

**–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è**: `keyboard_buttons`

**–ó–Ω–∞—á–µ–Ω–∏–µ** (–º–∞—Å—Å–∏–≤ –∫–Ω–æ–ø–æ–∫):
```json
[
  {{map(parseJSON(5.text); "text"; formatDate(date; "DD.MM") + " –≤ " + start_time; "callback_data"; "slot_" + slot_id)}}
]
```

–ò–ª–∏ —Å–æ–∑–¥–∞–π –≤—Ä—É—á–Ω—É—é —Å –ø–æ–º–æ—â—å—é Iterator:

**–ú–æ–¥—É–ª—å**: Flow Control ‚Üí Iterator

**Array**: `{{parseJSON(5.text)}}`

–î–ª—è –∫–∞–∂–¥–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ —Å–æ–∑–¥–∞–π –∫–Ω–æ–ø–∫—É:
```json
{
  "text": "{{formatDate(date; 'DD.MM')}} –≤ {{start_time}}",
  "callback_data": "slot_{{slot_id}}"
}
```

---

### üìç –®–∞–≥ 7: –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram

**–ú–æ–¥—É–ª—å**: Telegram Bot ‚Üí Send a Message

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏:**
- **Chat ID**: `{{1.client_id}}`
- **Text**: `{{6.choices[].message.content}}`
- **Parse Mode**: `Markdown`
- **Reply Markup**: 
  ```json
  {
    "inline_keyboard": [
      {{keyboard_buttons}}
    ]
  }
  ```

---

### üìç –®–∞–≥ 8: –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤—ã–±–æ—Ä —Å–ª–æ—Ç–∞ (Callback)

**–ù–æ–≤—ã–π —Ç—Ä–∏–≥–≥–µ—Ä**: Webhooks ‚Üí Custom Webhook –¥–ª—è callback

**–û–∂–∏–¥–∞–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```json
{
  "client_id": "123456789",
  "callback_data": "slot_S-1",
  "message_id": "12345"
}
```

**–®–∞–≥–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏:**

1. **–ò–∑–≤–ª–µ—á—å slot_id** –∏–∑ callback_data:
   ```
   {{substring(callback_data; 5)}}
   ```

2. **–í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å —Å–ª–æ—Ç** (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –æ–Ω –µ—â—ë –¥–æ—Å—Ç—É–ø–µ–Ω):
   - Google Sheets ‚Üí Search Rows
   - Filter: `slot_id = {{slot_id}} AND available = YES`

3. **–ï—Å–ª–∏ —Å–ª–æ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω:**
   - –í—ã–∑–≤–∞—Ç—å OpenAI (stage = "confirming_choice")
   - –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
   - –ü–µ—Ä–µ–¥–∞—Ç—å –≤ S3 –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

4. **–ï—Å–ª–∏ —Å–ª–æ—Ç –∑–∞–Ω—è—Ç:**
   - –í—ã–∑–≤–∞—Ç—å OpenAI (stage = "confirming_choice", slot_taken = true)
   - –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –¥—Ä—É–≥–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã

---

## System Prompts –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ç–∞–¥–∏–π

### Stage: `offer_slots`

```
–¢—ã ‚Äî –ò–ù–ö–ê, –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç —Ç–∞—Ç—É-–º–∞—Å—Ç–µ—Ä–∞ –ê–Ω–∏.
–¢—ã —Ä–∞–±–æ—Ç–∞–µ—à—å –≤ —Å—Ü–µ–Ω–∞—Ä–∏–∏ S2 (Booking Engine).

–ó–∞–¥–∞—á–∞: –ú—è–≥–∫–æ –∏ –∫–æ—Ä–æ—Ç–∫–æ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∫–ª–∏–µ–Ω—Ç—É –¥–æ—Å—Ç—É–ø–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã.

–î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ª–æ—Ç—ã:
{{available_slots}}

–ü—Ä–∞–≤–∏–ª–∞:
- –ß–µ–ª–æ–≤–µ—á–Ω—ã–π —Ç–æ–Ω, –≤–µ–∂–ª–∏–≤–æ
- –ö–æ—Ä–æ—Ç–∫–∏–π —Ç–µ–∫—Å—Ç (2-4 —Å—Ç—Ä–æ–∫–∏)
- –í—Å–µ –¥–∞—Ç—ã/–≤—Ä–µ–º—è ‚Äî —Å—Ç—Ä–æ–≥–æ –∏–∑ –º–∞—Å—Å–∏–≤–∞
- –ù–µ –ø—Ä–∏–¥—É–º—ã–≤–∞—Ç—å –Ω–æ–≤—ã–µ –¥–∞—Ç—ã
- –ü–µ—Ä–µ—á–∏—Å–ª–∏—Ç—å –≤—Å–µ —Å–ª–æ—Ç—ã
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: "–ù–∞–∂–º–∏ –Ω–∞ —É–¥–æ–±–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç, –∏ —è –∑–∞–∫—Ä–µ–ø–ª—é –≤—Ä–µ–º—è."

–ï—Å–ª–∏ –º–∞—Å—Å–∏–≤ –ø—É—Å—Ç–æ–π:
"–°–µ–π—á–∞—Å —Å–≤–æ–±–æ–¥–Ω—ã—Ö –æ–∫–æ–Ω –¥–ª—è —ç—Ç–æ–≥–æ —Ç–∏–ø–∞ –∑–∞–ø–∏—Å–∏ –Ω–µ—Ç.
–ú–æ–≥—É –Ω–∞–ø–∏—Å–∞—Ç—å —Ç–µ–±–µ, –∫–∞–∫ —Ç–æ–ª—å–∫–æ –ø–æ—è–≤–∏—Ç—Å—è –ø–æ–¥—Ö–æ–¥—è—â–µ–µ –≤—Ä–µ–º—è."
```

### Stage: `confirming_choice`

```
–¢—ã ‚Äî –ò–ù–ö–ê, –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç —Ç–∞—Ç—É-–º–∞—Å—Ç–µ—Ä–∞ –ê–Ω–∏.
–¢—ã —Ä–∞–±–æ—Ç–∞–µ—à—å –≤ —Å—Ü–µ–Ω–∞—Ä–∏–∏ S2 (Booking Engine).

–ó–∞–¥–∞—á–∞: –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤—ã–±–æ—Ä –∫–ª–∏–µ–Ω—Ç–∞.

–í—ã–±—Ä–∞–Ω–Ω—ã–π —Å–ª–æ—Ç:
–î–∞—Ç–∞: {{selected_slot.date}}
–í—Ä–µ–º—è: {{selected_slot.start_time}}

–ü—Ä–∞–≤–∏–ª–∞:
- –°–ø–æ–∫–æ–π–Ω—ã–π, —É–≤–µ—Ä–µ–Ω–Ω—ã–π —Ç–æ–Ω
- –ö–æ—Ä–æ—Ç–∫–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
- –ù–µ –ø–æ–≤—Ç–æ—Ä—è—Ç—å –º–∞—Å—Å–∏–≤ —Å–ª–æ—Ç–æ–≤
- –ù–µ –∑–∞–¥–∞–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã

–®–∞–±–ª–æ–Ω –æ—Ç–≤–µ—Ç–∞:
"–û—Ç–ª–∏—á–Ω–æ, –∑–∞–ø–∏—Å–∞–ª–∞ —Ç–µ–±—è –Ω–∞ [–¥–∞—Ç–∞] –≤ [–≤—Ä–µ–º—è].
–°–∫–æ—Ä–æ –ø—Ä–∏—à–ª—é –¥–µ—Ç–∞–ª–∏ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É –∫ —Å–µ–∞–Ω—Å—É."

–ï—Å–ª–∏ —Å–ª–æ—Ç –∑–∞–Ω—è—Ç (slot_taken = true):
"–≠—Ç–æ—Ç —Å–ª–æ—Ç —Ç–æ–ª—å–∫–æ —á—Ç–æ –∑–∞–Ω—è–ª–∏.
–•–æ—á–µ—à—å –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥—Ä—É–≥–∏–µ —Å–≤–æ–±–æ–¥–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã?"
```

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –¢–µ—Å—Ç 1: –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Å–ª–æ—Ç–æ–≤

**Input:**
```json
{
  "route": "booking",
  "stage": "offer_slots",
  "booking_type": "tattoo"
}
```

**Expected Output:**
```
–í–æ—Ç –±–ª–∏–∂–∞–π—à–∏–µ —Å–≤–æ–±–æ–¥–Ω—ã–µ –æ–∫–Ω–∞:

‚Äî 12.12 –≤ 14:00
‚Äî 14.12 –≤ 15:00
‚Äî 15.12 –≤ 12:00

–ù–∞–∂–º–∏ –Ω–∞ —É–¥–æ–±–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç, –∏ —è –∑–∞–∫—Ä–µ–ø–ª—é –≤—Ä–µ–º—è.
```

### –¢–µ—Å—Ç 2: –ù–µ—Ç —Å–ª–æ—Ç–æ–≤

**Input:**
```json
{
  "route": "booking",
  "stage": "offer_slots",
  "booking_type": "walk-in"
}
```

**Expected Output:**
```
–°–µ–π—á–∞—Å —Å–≤–æ–±–æ–¥–Ω—ã—Ö –æ–∫–æ–Ω –¥–ª—è —ç—Ç–æ–≥–æ —Ç–∏–ø–∞ –∑–∞–ø–∏—Å–∏ –Ω–µ—Ç.
–ú–æ–≥—É –Ω–∞–ø–∏—Å–∞—Ç—å —Ç–µ–±–µ, –∫–∞–∫ —Ç–æ–ª—å–∫–æ –ø–æ—è–≤–∏—Ç—Å—è –ø–æ–¥—Ö–æ–¥—è—â–µ–µ –≤—Ä–µ–º—è.
```

### –¢–µ—Å—Ç 3: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ

**Input:**
```json
{
  "callback_data": "slot_S-1",
  "selected_slot": {
    "date": "2025-12-12",
    "start_time": "14:00"
  }
}
```

**Expected Output:**
```
–û—Ç–ª–∏—á–Ω–æ, –∑–∞–ø–∏—Å–∞–ª–∞ —Ç–µ–±—è –Ω–∞ 12.12 –≤ 14:00.
–°–∫–æ—Ä–æ –ø—Ä–∏—à–ª—é –¥–µ—Ç–∞–ª–∏ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É –∫ —Å–µ–∞–Ω—Å—É.
```

---

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Python –±–æ—Ç–æ–º

### –í Python –±–æ—Ç–µ (–æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ Make.com):

```python
import requests
from src.services.inka_ai import INKA

inka = INKA()

# S1: Classification
result = inka.process(
    message="—Ö–æ—á—É –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —Ç–∞—Ç—É",
    client_context={"client_id": message.from_user.id}
)

# –ï—Å–ª–∏ route = booking –∏ next_action = offer_slots
if result['next_action'] == 'offer_slots':
    # –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Make.com webhook S2
    webhook_url = "https://hook.make.com/your-webhook-url"
    
    payload = {
        "client_id": message.from_user.id,
        "client_name": message.from_user.first_name,
        "route": result['classification']['route'],
        "stage": result['classification']['stage'],
        "booking_type": result['classification']['booking_type'],
        "message": message.text
    }
    
    response = requests.post(webhook_url, json=payload)
```

### –í Python –±–æ—Ç–µ (–æ–±—Ä–∞–±–æ—Ç–∫–∞ callback –æ—Ç –∫–Ω–æ–ø–∫–∏):

```python
@router.callback_query(lambda c: c.data.startswith("slot_"))
async def handle_slot_selection(callback: types.CallbackQuery):
    slot_id = callback.data.replace("slot_", "")
    
    # –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Make.com webhook S2 (confirming_choice)
    webhook_url = "https://hook.make.com/your-s2-callback-webhook"
    
    payload = {
        "client_id": callback.from_user.id,
        "callback_data": callback.data,
        "slot_id": slot_id,
        "message_id": callback.message.message_id
    }
    
    response = requests.post(webhook_url, json=payload)
    
    await callback.answer("–û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é...")
```

---

## Troubleshooting

| –ü—Ä–æ–±–ª–µ–º–∞ | –†–µ—à–µ–Ω–∏–µ |
|----------|---------|
| –ò–ù–ö–ê –ø—Ä–∏–¥—É–º—ã–≤–∞–µ—Ç –¥–∞—Ç—ã | –ü—Ä–æ–≤–µ—Ä—å System Prompt ‚Äî –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å "–¢–µ–±–µ –∑–∞–ø—Ä–µ—â–µ–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –¥–∞—Ç—ã" |
| –°–ª–æ—Ç—ã –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è | –ü—Ä–æ–≤–µ—Ä—å —Ñ–∏–ª—å—Ç—Ä –≤ Google Sheets: `available = YES` |
| –ö–Ω–æ–ø–∫–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç | –ü—Ä–æ–≤–µ—Ä—å —Ñ–æ—Ä–º–∞—Ç callback_data: `slot_{{slot_id}}` |
| OpenAI –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON –≤–º–µ—Å—Ç–æ —Ç–µ–∫—Å—Ç–∞ | –ü—Ä–æ–≤–µ—Ä—å –ø—Ä–æ–º–ø—Ç: "–¢—ã –≤—ã–≤–æ–¥–∏—à—å –¢–û–õ–¨–ö–û —Ç–µ–∫—Å—Ç, –±–µ–∑ JSON" |
| –°–ª–æ—Ç—ã –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è | –î–æ–±–∞–≤—å `Unique = true` –≤ Google Sheets –º–æ–¥—É–ª–µ |

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –°–æ–∑–¥–∞–π —Å—Ü–µ–Ω–∞—Ä–∏–π S2 –≤ Make.com
2. ‚úÖ –°–∫–æ–ø–∏—Ä—É–π System Prompt –∏–∑ `INKA_S2_BOOKING_ENGINE_PROMPT.md`
3. ‚úÖ –ù–∞—Å—Ç—Ä–æ–π Google Sheets –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é
4. ‚úÖ –ù–∞—Å—Ç—Ä–æ–π OpenAI –º–æ–¥—É–ª—å
5. ‚úÖ –ù–∞—Å—Ç—Ä–æ–π Telegram Bot –º–æ–¥—É–ª—å
6. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
7. ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π —Å Python –±–æ—Ç–æ–º (webhook)
8. ‚úÖ –°–æ–∑–¥–∞–π S3 (Confirmation) —Å—Ü–µ–Ω–∞—Ä–∏–π

---

**–ì–æ—Ç–æ–≤–æ! –°–∏—Å—Ç–µ–º–∞ S2 –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ! üöÄ**
